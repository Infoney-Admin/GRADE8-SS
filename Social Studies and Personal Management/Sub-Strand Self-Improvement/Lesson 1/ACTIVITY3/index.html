<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aria the Eagle's Journey</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* ====== FONT IMPORTS ====== */
        @font-face {
            font-family: 'Fredoka';
            src: url('../assets/Fredoka-VariableFont_wdth\,wght.ttf') format('truetype');
        }
        ::-webkit-scrollbar{
            display: none;
        }
        /* ====== ROOT VARIABLES & SCALING ====== */
        :root {
            --primary-color: #5D04B2;
            --secondary-color: #FBB03B;
            --correct-color: #5cb85c;
            --incorrect-color: #d9534f;
            --text-color-dark: #333;
            --text-color-light: #fff;
            --border-radius: 1rem;
            --header-font: 'Fredoka', 'Poppins', sans-serif;
            --body-font: var(--header-font);
        }
        
        html {
             font-size: 1.8vmin;
        }

        /* ===== HIDE SCROLLBAR ===== */
        body::-webkit-scrollbar, .scenario-content::-webkit-scrollbar, .modal::-webkit-scrollbar { display: none; }
        body, .scenario-content, .modal { scrollbar-width: none; -ms-overflow-style: none; }

        /* ====== GLOBAL BASE ====== */
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; background: #f0f4f8;
            font-family: var(--body-font);
            overflow: hidden;
        }
        #game-wrapper {
            width: 100%; max-width: 1200px; aspect-ratio: 16 / 9;
            overflow: hidden;
            display: flex; flex-direction: column; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
            position: relative;
        }
        #game-container {
            width: 100%; height: 100%; background: #fff;
            position: relative; display: flex; flex-direction: column;
        }
        .screen {
            position: absolute; width: 100%; height: 100%; top: 0; left: 0;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.5s ease-in-out, visibility 0.5s;
            pointer-events: all; visibility: visible;
        }
        .hidden { opacity: 0; pointer-events: none; visibility: hidden; }

        /* ===== START SCREEN ===== */
        #start-screen {
            color: var(--text-color-light); text-align: center; padding: 2rem;
            background-image: url('images/gamebg.jpg'); background-size: cover; background-position: center;
        }
        #start-screen h1 {
            color: var(--text-color-light); font-size: 3.2rem;
            font-family: var(--header-font);
            font-weight: 500;
        }
        .start-button { 
            background: #FBB03B;
            color: #fff;
            font-weight: 500;
            font-size: 1.32rem;
            border: 3.6px solid #fff;
            border-radius: 3rem;
            padding: 0.72rem 2.64rem;
            margin-top: 1rem;
            cursor: pointer;
            letter-spacing: 0.04em;
            text-shadow: 0 2px 0 #b88b2a;
            transition: all 0.2s;
            font-family: var(--header-font);
            white-space: nowrap;
        }
        .start-button:hover { transform: scale(1.06); box-shadow: 0 6px 24px rgba(0,0,0,0.18); }


        /* ===== GAME SCREEN STYLES ===== */
        #game-screen { 
            justify-content: flex-start; 
            overflow: hidden; 
            position: relative;
            display: flex;
            flex-direction: column;
            background-image: url('https://placehold.co/1200x675/c1e1c1/ffffff?text=Ga');
            background-size: cover;
        }
        
        .game-top-section { 
            width: 100%; background-color: #5D04B2; 
            padding: clamp(0.5rem, 1.5vmin, 0.75rem) clamp(0.75rem, 2vmin, 1.25rem);
            display: flex; justify-content: space-between; align-items: center;
            color: #fff; z-index: 20;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            flex-shrink: 0;
        }
        #game-title {
        font-weight: 600;
            margin: 0; font-family: var(--header-font);
        }
        .top-right-controls { display: flex; align-items: center; gap: 1rem; }
        
        #progress-container { 
            width: clamp(100px, 20vw, 200px); background-color: rgba(255,255,255,0.3);
            border-radius: 1rem; height: clamp(15px, 2.5vmin, 20px);
            border: 2px solid #fff; position: relative; overflow: hidden;
        }
        #progress-bar {
            height: 100%; width: 0%; background: #FFFF00;
            border-radius: 0.8rem; transition: width 0.5s ease;
        }
        #progress-text {
            font-weight: 600; color: #fff;
            text-shadow: none;
        }

        .instructions-icon {
            width: 2.5rem; height: 2.5rem; background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 50%; display: flex;
            align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease;
            z-index: 15; flex-shrink: 0;
            animation: glow-pulse-white 2s infinite;
        }
        .instructions-icon:hover { background: rgba(255, 255, 255, 0.3); transform: scale(1.1); }
        .instructions-icon svg { width: 1.25rem; height: 1.25rem; fill: white;}

        .hint-icon {
            position: absolute; bottom: 1.5rem; right: 1.5rem; width: 3.125rem; height: 3.125rem;
            background: var(--secondary-color); border-radius: 50%; display: flex;
            align-items: center; justify-content: center; cursor: pointer; transition: all 0.3s ease;
            z-index: 1001;
            border: 0.1875rem solid white;
            animation: glow-pulse 2s infinite;
        }
        .hint-icon:hover { transform: scale(1.1); }
        .hint-icon svg { fill: white; width: 1.5rem; height: 1.5rem; }

        /* ===== MODALS ===== */
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.4);
            backdrop-filter: blur(5px);
            z-index: 3000;
            display: flex; justify-content: center; align-items: center;
            animation: fadeIn 0.3s ease;
        }
        .overlay.hidden { display: none; visibility: hidden; opacity: 0; }
        .modal {
            background: #fff; padding: 2.5rem; border-radius: 1rem;
            text-align: center; width: 90%; max-width: 600px;
            animation: slideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(30px) scale(0.95); opacity: 0; } to { transform: translateY(0) scale(1); } }

        .modal h2 {
            font-size: 2rem; font-weight: 600; margin-bottom: 1.5rem;
            font-family: var(--header-font);
        }
        .modal p, .modal ul { font-size: 1.5rem; line-height: 1.6; color: var(--text-color-dark, #333); }
        
        #activity-intro-overlay .modal { border-top: 8px solid var(--primary-color); }
        #activity-intro-overlay .modal h2 { color: var(--primary-color); }
        #activity-intro-overlay .modal p {
            text-align: left; background: #f8f9fa; padding: 1.5rem;
            border-radius: 0.75rem; border-left: 4px solid var(--primary-color);
        }
        
        #instructions-overlay .modal { border-top: 8px solid var(--primary-color); }
        #instructions-overlay .modal h2 { color: var(--primary-color); }
        #instructions-overlay .modal ol { text-align: left; padding-left: 2rem; font-size: 1.2rem; }

        #hint-overlay .modal { border-top: 8px solid var(--secondary-color); }
        #hint-overlay .modal h2 { 
            color: var(--secondary-color); display: flex; 
            align-items: center; justify-content: center; gap: 0.75rem; 
        }
        #hint-overlay ul { text-align: left; list-style-position: inside; }

        /* Modal Buttons */
        .modal button {
            width: 100%; padding: 1rem; font-size: 1.2rem; font-weight: 700;
            border: none; border-radius: 0.75rem; cursor: pointer; color: #fff;
            transition: transform 0.2s, box-shadow 0.2s; margin-top: 1rem;
        }
        .modal button:hover { transform: scale(1.02); }
        #activity-intro-overlay button, #instructions-overlay button { background-color: var(--primary-color); }
        #hint-overlay button { background-color: var(--secondary-color); }

        /* Feedback Modals */
        .feedback-modal { max-width: 480px; }
    .feedback-header { display: flex; align-items: center; justify-content: center; gap: 0.75rem; margin-bottom: 1rem; }
    .feedback-header h2 { font-size: 2rem; font-weight: 700; margin: 0; line-height: 1; }
    /* make svg icons match the heading color and align with text */
    .feedback-header svg { width: 2rem; height: 2rem; display: inline-block; vertical-align: middle; color: inherit; }
    /* Specific coloring for correct/incorrect states (applies to both h2 and svg) */
    .feedback-header.correct { color: var(--correct-color); }
    .feedback-header.incorrect { color: var(--incorrect-color); }
        .feedback-btn.correct { background-color: var(--correct-color); }
        .feedback-btn.incorrect { background-color: var(--incorrect-color); }
        #feedback-correct-overlay .modal { border-top: 8px solid var(--correct-color); }
        #feedback-incorrect-overlay .modal { border-top: 8px solid var(--incorrect-color); }

        /* ===== COMPLETION SCREEN ===== */
        #completion-overlay { 
            background-image: url('images/gamebg.jpg'); background-size: cover; background-position: center;
            color: #fff; display: flex; flex-direction: column; justify-content: center;
            align-items: center; gap: 1rem; padding: 1rem;
        }
        .completion-title-banner { 
            font-size: clamp(2rem, 7vmin, 4rem);
            text-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.2);
            text-align: center; font-family: var(--header-font);
            font-weight: 500;
        }
        #completion-overlay .modal { 
            background: transparent; box-shadow: none; width: auto; max-width: none;
            display: flex; justify-content: center; align-items: center;
            padding: 0; overflow: visible;
        }
        #completion-image { 
            width: 69%; max-width: 85%; height: auto;
            border: 3px solid #FBB03B; border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-top: 0.5rem;
        }
        .completion-buttons {
            display: flex;
            justify-content: space-between;
            gap: 1.5rem;
            width: 100%;
            padding: 1rem 2rem;
        }
        .completion-btn { 
            font-family: var(--header-font); background: var(--secondary-color); color: #fff;
            font-weight: 500; 
            font-size: 1.3rem;
            border: 0.1875rem solid #fff; border-radius: 3rem; 
            padding: clamp(0.5rem, 1.5vmin, 0.75rem) clamp(1.25rem, 3vmin, 2rem);
            cursor: pointer; transition: all 0.2s;
            box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.2);
            text-shadow: 0 0.125rem 0 #b88b2a; text-decoration: none;
            min-width: 8.75rem; /* 140px */
        }
        .completion-btn:hover { transform: scale(1.05); box-shadow: 0 0.5rem 1.25rem rgba(0,0,0,0.2); }
    
        /* ===== TAKEAWAYS OVERLAY ===== */
        #takeaways-overlay {
            background-image: url('images/gamebg.jpg'); flex-direction: column; justify-content: center;
        }
        .takeaways-main-header {
            font-family: var(--header-font); color: white; font-size: 3.5rem;
            position: absolute; top: 5%; text-align: center; width: 100%;
            text-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.3);
        }
        #takeaways-overlay .modal { max-width: 800px; padding: 2rem; display: flex; flex-direction: column; align-items: center; height: 50vh;
            overflow-y: auto;
            margin-top: 4rem;
        }
        .takeaways-header { color:var(--primary-color); display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1.5rem; }
        .takeaways-header h3 { font-family: var(--header-font); font-size: 1.8rem; color: var(--primary-color); }
        #takeaways-list { list-style-type: none; padding: 0; width: 100%; }
        #takeaways-list li {margin-bottom: 0.35rem; padding: 1rem; border-radius: 0.5rem; font-size: 1.1rem; text-align: left; }
        
        .end-lesson-btn {
            background: var(--secondary-color); font-family: var(--header-font); color: #fff; font-weight: 900;
            font-size: 1.3rem; border: 3px solid #fff; border-radius: 3rem;
            padding: clamp(0.5rem, 1.5vmin, 0.75rem) clamp(1.25rem, 3vmin, 2rem);
            text-shadow: 0 2px 0 #b88b2a; box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            width: auto; min-width: 180px; margin-top: 2rem;
        }
        .end-lesson-btn:hover { transform: scale(1.06); box-shadow: 0 6px 24px rgba(0,0,0,0.18); }

        /* ===== STORYBOOK LAYOUT ===== */
        .scenario-title {
            font-family: var(--header-font); color: var(--text-color-light);
            font-size: 2.2rem; text-align: center; padding: 1rem;
            width: 100%; margin-bottom: 0.5rem; flex-shrink: 0;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .scenario-content {
            flex: 1; padding: 1rem 2rem; overflow: hidden; display: flex;
            justify-content: center; align-items: center; margin-top: 0;
            perspective: 2500px;
        }

        .book-container {
            width: 100%;
            max-width: 80rem;
            height: 95%;
            display: flex;
            position: relative;
            transition: transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1);
            background-color: #fff;
            border-radius: 0.5rem;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4), inset 0 0 10px rgba(0,0,0,0.5);
        }

        .book-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 1.5rem;
            height: 100%;
            background-image: linear-gradient(to right, rgba(0,0,0,0.3), rgba(0,0,0,0) 30%, rgba(255,255,255,0.1) 50%, rgba(0,0,0,0) 70%, rgba(0,0,0,0.3));
            z-index: 10;
        }

        .book-container.story-view {
             transform: translateX(0%);
        }
         .book-container.split-view {
             transform: translateX(0%);
        }

        .book-page {
            flex: 1;
            background: linear-gradient(to right, #ffc782, #fffefc);
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            transition: opacity 0.5s;
            box-shadow: inset 5px 0 15px -5px rgba(0,0,0,0.2);
        }
        .book-page.left {
            border-right: 1px solid #ddd;
        }
        .book-page.right {
            transition: opacity 0.6s ease-in-out 0.3s;
        }
        .story-view .book-page.right {
            opacity: 0;
            pointer-events: none;
            visibility: hidden;
        }
        .split-view .book-page.right {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
        }


        .scenario-story { 
            font-size: 1.4rem; color: #444; line-height: 1.7; 
            text-align: center; width: 100%;
        }
        
        #scenario-image {
            max-width: 90%; height: auto; max-height:35vh;
            border-radius: 0.75rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        #question-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s 0.2s, visibility 0.5s 0.2s;
        }
        #question-section.visible {
            opacity: 1;
            visibility: visible;
        }

        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #question-section.visible > * {
            opacity: 0; /* Start hidden for animation */
        }
        
        #question-section.visible #question-text { 
            animation: fade-in-up 0.5s cubic-bezier(0.645, 0.045, 0.355, 1) 0.6s forwards;
        }
        
        #question-section.visible .options-container {
             animation: fade-in-up 0.5s cubic-bezier(0.645, 0.045, 0.355, 1) 0.8s forwards;
        }
        
        #question-text { 
            font-family: var(--header-font); color: var(--text-color-dark); 
            font-size: 1.5rem; margin-bottom: 1.5rem; text-align: center; 
            font-weight: 500;
        }
        
        .options-container { display: flex; flex-direction: column; gap: 1rem; width: 100%; max-width: 450px; }
        .option-button {
            background: #fff; border: 2px solid #ddd; border-radius: 1rem; padding: 1.2rem; cursor: pointer;
            transition: all 0.3s ease; font-size: 1.2rem; color: var(--text-color-dark); font-weight: 700;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        .option-button:hover:not(:disabled) { transform: translateY(-3px); border-color: var(--primary-color); box-shadow: 0 6px 15px rgba(0,0,0,0.1); }
        .option-button.correct { background: var(--correct-color); color: white; border-color: #fff; transform: scale(1.02); }
        .option-button.incorrect { background: var(--incorrect-color); color: white; animation: shake 0.5s; }
        .option-button:disabled { cursor: not-allowed; opacity: 0.7; }

        .continue-story-btn {
            font-family: var(--header-font);
            background: var(--primary-color);
            color: #fff;
            font-weight: 500;
            font-size: 1.1rem;
            border: none;
            border-radius: 3rem;
            padding: 0.8rem 2.5rem;
            margin-top: 0rem;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 2rem;
        }
        .continue-story-btn:hover { transform: scale(1.05); }

        /* Page Turn Animation */
        #page-turner {
            position: absolute;
            top: 0; left: 50%;
            width: 50%; height: 100%;
            transform-origin: left;
            transform-style: preserve-3d;
            display: none;
            z-index: 15;
            pointer-events: none;
        }
        #page-turner.turning {
            display: block;
            animation: turn-page 1.2s forwards ease-in-out;
        }
        
        #page-turner .page-content {
            position: absolute;
            width: 100%; height: 100%;
            padding: 2rem;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
        }
        
        #page-turner .front {
            background: linear-gradient(to left, #f9f5f0, #fffefc);
            box-shadow: inset -5px 0 15px -5px rgba(0,0,0,0.2);
        }
        
        #page-turner .back {
            background: linear-gradient(to right, #f9f5f0, #fffefc);
            box-shadow: inset 5px 0 15px -5px rgba(0,0,0,0.2);
            transform: rotateY(180deg);
        }
        
        @keyframes turn-page {
            0% { transform: rotateY(0deg); }
            100% { transform: rotateY(-180deg); }
        }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 20%, 60% { transform: translateX(-8px); } 40%, 80% { transform: translateX(8px); } }

        /* ===== Glowing Pulsating Effect Keyframes ====== */
        @keyframes glow-pulse { 0%, 100% { box-shadow: 0 0 10px rgba(251,176,59,0.5), 0 0 20px rgba(251,176,59,0.3); transform: scale(1); } 50% { box-shadow: 0 0 20px rgba(251,176,59,0.8), 0 0 30px rgba(251,176,59,0.5); transform: scale(1.1); } }
        @keyframes glow-pulse-white { 0%, 100% { box-shadow: 0 0 10px rgba(255,255,255,0.7), 0 0 20px rgba(255,255,255,0.5); transform: scale(1); } 50% { box-shadow: 0 0 20px rgba(255,255,255,1), 0 0 30px rgba(255,255,255,0.7); transform: scale(1.1); } }

        /* ===== RESPONSIVE DESIGN ===== */
        @media(min-width:1400px){
             #scenario-image {
                max-width: 80%;
                height: auto;
                max-height: 27vh;
                border-radius: 0.75rem;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }
        }
        @media(min-width:1200px){
            .book-container{
                height: 106%;
            }
            .scenario-story {
                font-size: 1.4rem;
                color: #444;
                line-height: 1.5;
                text-align: center;
                width: 100%;
                /* font-family: 'Georgia', serif; */
                margin-top: 2rem;
            }
           
        }
        @media (max-width: 1024px) { html { font-size: 2vmin; } }
        @media (max-width: 991px) {
            #game-wrapper { width: 100vw; height: 100vh; border-radius: 0; aspect-ratio: unset; }
            html{ font-size: 3vmin; }
            .book-container, .book-container.story-view, .book-container.split-view {height: auto; max-height: 100%; overflow-y: auto; box-shadow: none; transform: none !important; }
            .book-container::before { display: none; }
            .book-page { padding: 1.5rem; flex: 1; }
            .book-page.left {
                border-right: none;
                border-bottom: 2px solid #dedede;
                overflow: auto;
                justify-content: flex-start;
            }
           
       .story-view .book-page.right { display: none; }
            .split-view .book-page.right { display: flex; opacity: 1; }
            #question-section.visible { padding-top: 1.5rem; }
            #page-turner { display: none !important; }

            .completion-buttons {align-items: center; }
            #takeaways-overlay .modal{ height: 60vh; }
            .completion-title-banner{ top:1%; }
            #completion-image { width: 57%; }
        }
        @media (max-width: 768px) {
            html { font-size: 3.3vmin; }
            .scenario-title { font-size: 1.8rem; }
            .scenario-content { padding: 1rem; }
            .completion-title-banner { font-size: 1.8rem; }
            #completion-image { max-width: 66%; }
            .completion-btn { min-width: 155px; }
            .scenario-story{ line-height: 1.4; font-size: 1.2rem; }
            .book-page { gap: 1rem; }
        }
    </style>
</head>
<body>

<div id="game-wrapper">
    <div id="game-container">
        <div id="start-screen" class="screen">
            <h1>Aria the Eagle's Journey</h1>
            <button class="start-button" onclick="showActivityIntro();">Start Activity</button>
        </div>

        <div id="game-screen" class="screen hidden">
            <div class="game-top-section">
                <h1 id="game-title">Aria's Journey</h1>
                <div class="top-right-controls">
                    <div id="progress-container"><div id="progress-bar"></div></div>
                    <span id="progress-text">0 / 3</span>
                    <div class="instructions-icon" onclick="showInstructions()">
                        <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>
                    </div>
                </div>
            </div>

            <h2 class="scenario-title" id="scenario-title"></h2>
            
            <div class="scenario-content">
                <div class="book-container" id="book-container">
                    <div class="book-page left">
                        <p class="scenario-story" id="scenario-story-text"></p>
                        <img id="scenario-image" src="" alt="Scenario Image">
                        <button class="continue-story-btn" id="continue-story-btn" onclick="showQuestion()">Continue</button>
                    </div>
                    <div class="book-page right">
                        <div id="question-section">
                             <h3 id="question-text"></h3>
                            <div class="options-container" id="options-container"></div>
                        </div>
                    </div>
                    <div id="page-turner">
                        <div class="page-content front" id="page-turner-front"></div>
                        <div class="page-content back" id="page-turner-back"></div>
                    </div>
                </div>
            </div>
            
            <div class="hint-icon" id="hint-icon" onclick="showHint()">
                <svg viewBox="0 0 24 24"><path d="M9 21c0 .5.4 1 1 1h4c.6 0 1-.5 1-1v-1H9v1zm3-19C8.1 2 5 5.1 5 9c0 2.4 1.2 4.5 3 5.7V17c0 .5.4 1 1 1h6c.6 0 1-.5 1-1v-2.3c1.8-1.3 3-3.4 3-5.7 0-3.9-3.1-7-7-7z"></path></svg>
            </div>
        </div>

        <div id="completion-overlay" class="overlay hidden">
            <h2 class="completion-title-banner" id="completion-title-banner">Activity Conclusion</h2>
            <img id="completion-image" src="images/complete.jpg" alt="Activity Complete Summary">
            <div class="completion-buttons">
                <button class="completion-btn btn-prev" onclick="goToPreviousActivity()">Previous Activity</button>
                <button class="completion-btn btn-restart" onclick="restartGame()">Restart Activity</button>
                <button class="completion-btn btn-next" onclick="showTakeaways()">Key Takeaways</button>
            </div>
        </div>

        <div id="takeaways-overlay" class="overlay hidden">
            <h2 class="takeaways-main-header">Lesson Complete!</h2>
            <div class="modal">
                <div class="takeaways-header">
                    <h3>Key Takeaways</h3>
                </div>
                <ul id="takeaways-list"></ul>
            </div>
            <button class="end-lesson-btn" onclick="sendEvent(LessonEvent.END_LESSON, {lessonName: 'Personality Traits that Help with Self-Understanding: Lesson 1'})">Exit Lesson</button>
        </div>

        <div id="activity-intro-overlay" class="overlay hidden">
            <div class="modal">
                <h2>Activity Introduction</h2>
                <p id="intro-text"></p>
                <button onclick="closeModal('activity-intro-overlay')">Continue</button>
            </div>
        </div>

        <div id="instructions-overlay" class="overlay hidden">
            <div class="modal">
                <h2>Learner Instructions</h2>
                <ol id="instructions-list"></ol>
                <button onclick="closeModal('instructions-overlay')">Got it!</button>
            </div>
        </div>
        
        <div id="hint-overlay" class="overlay hidden">
            <div class="modal">
                <h2>Here's a hint...</h2>
                <ul id="hint-list"></ul>
                <button onclick="closeModal('hint-overlay')">Got it!</button>
            </div>
        </div>
        
        <div id="feedback-correct-overlay" class="overlay hidden">
            <div class="modal feedback-modal">
                <div class="feedback-header correct">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="width:2rem;height:2rem;"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                    <h2>Well Done!</h2>
                </div>
                <p id="correct-feedback-text"></p>
                <button class="feedback-btn correct" onclick="closeModal('feedback-correct-overlay')">Next Page</button>
            </div>
        </div>
        
        <div id="feedback-incorrect-overlay" class="overlay hidden">
            <div class="modal feedback-modal">
                <div class="feedback-header incorrect">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="width:2rem;height:2rem;"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>
                    <h2>Not Quite</h2>
                </div>
                <p id="incorrect-feedback-text"></p>
                <button class="feedback-btn incorrect" onclick="handleTryAgain()">Try Again</button>
            </div>
        </div>
    </div>
</div>

<script>
    const activityData = {
        introduction: "Aria is a young eagle learning how to fly. Through her story, you will make choices that reveal important traits such as resilience, curiosity, and adaptability. Let us see what kind of eagle Aria becomes with your help.",
        instructions: [
            "Read each scene carefully.",
            "Click the choice you think Aria should make.",
            "Your decision will reveal the personality trait demonstrated."
        ],
        hints: [
            "What would a curious eagle do when watching others?",
            "How would a resilient eagle act after failing?",
            "What could an adaptable eagle do in a storm?"
        ],
        keyTakeaways: [
            "<strong>Personality traits</strong> are consistent patterns of behaviour, thought, and emotion.",
            "The <strong>Big Five traits</strong> help us understand differences among people.",
            "Animals can reflect human-like traits such as <strong>loyalty, confidence, and patience</strong>.",
            "<strong>Self-reflection</strong> builds awareness, growth, and stronger relationships."
        ],
        scenarios: [
            {
                title: "Chapter 1: The First Flight",
                story: "Aria stands at the edge of the cliff, heart pounding. She takes a leap, flaps her wings wildly, but tumbles down onto a soft ledge below. What should she do?",
                image: "images/eagleraaah.jpg",
                question: "How should Aria react to her fall?",
                options: [
                    { text: "Keep flapping hard", trait: "Resilience", feedback: " You chose to keep flapping. That shows <strong>resilience</strong>, just like people who don’t give up when learning something new." },
                    { text: "Give up and hide", trait: "Fear", feedback: "Giving up feels safe, but it shows <strong>fear</strong>. Resilient learners keep trying until they succeed." }
                ],
                correctIndex: 0
            },
            {
                title: "Chapter 2: The Elders",
                story: "From her nest, Aria spots the older, wiser eagles soaring effortlessly on the wind currents. They dip and dive with incredible skill. What is the best way for her to learn?",
                image: "images/eagle(.jpg",
                 question: "What should Aria do?",
                options: [
                    { text: "Watch and learn", trait: "Curiosity", feedback: " Watching and learning shows <strong>curiosity</strong>. Curious learners pay attention and grow through observation." },
                    { text: "Ignore them", trait: "Missed Opportunity", feedback: "Ignoring others means missing a chance to learn. Being curious opens the door to new ideas." }
                ],
                correctIndex: 0
            },
            {
                title: "Chapter 3: The Storm",
                story: "Dark clouds gather and a powerful storm rolls in. The wind howls, making flight seem impossible. Some eagles retreat to caves. What should Aria do?",
                image: "images/wtfisaKILOMETERRRR!!.jpg",
                 question: "How can Aria face the storm?",
                options: [
                    { text: "Use wind to rise", trait: "Adaptability", feedback: " Using the wind to rise shows <strong>adaptability</strong>. Adaptable learners use challenges to improve themselves." },
                    { text: "Hide in cave", trait: "Avoids Challenge", feedback: "Hiding avoids the challenge, but nothing new is learned. Adaptability helps us face storms in life." }
                ],
                correctIndex: 0
            }
        ]
    };

    let currentScenarioIndex = 0;
    const totalScenarios = activityData.scenarios.length;
    let selectedOptionIndex = null;
    let introAudio, dingAudio, buzzAudio, outroAudio, pageTurnAudio;

    function initAudio() {
        try {
            introAudio = new Audio('audio/intro.mp3');
            dingAudio = new Audio('audio/ding.mp3');
            buzzAudio = new Audio('audio/buzz.mp3');
            outroAudio = new Audio('audio/outro.mp3');
            pageTurnAudio = new Audio('audio/page-flip.mp3');
        } catch (e) {
            console.warn("Audio could not be loaded.");
            const mockAudio = { play: () => {}, pause: () => {}, currentTime: 0 };
            introAudio = dingAudio = buzzAudio = outroAudio = pageTurnAudio = mockAudio;
        }
    }

    function playSound(audio) { if(audio) { audio.currentTime = 0; audio.play().catch(e => {}); } }
    function stopSound(audio) { if(audio) { audio.pause(); } }

    function initGame() {
        loadScenario();
    }
    
    function loadScenario() {
        selectedOptionIndex = null;
        const bookContainer = document.getElementById('book-container');
        bookContainer.className = 'book-container story-view';

        const scenario = activityData.scenarios[currentScenarioIndex];
        
        document.getElementById('scenario-title').textContent = scenario.title;
        document.getElementById('scenario-story-text').innerHTML = scenario.story;
        document.getElementById('scenario-image').src = scenario.image;
        document.getElementById('scenario-image').alt = scenario.title;
        
        document.getElementById('question-section').classList.remove('visible');
        document.getElementById('continue-story-btn').style.visibility = 'visible';

        const optionsContainer = document.getElementById('options-container');
        optionsContainer.innerHTML = ''; 
        
        updateProgress();
    }
    
    function showQuestion() {
        const bookContainer = document.getElementById('book-container');
        bookContainer.className = 'book-container split-view';

        const scenario = activityData.scenarios[currentScenarioIndex];
        document.getElementById('question-text').textContent = scenario.question;

        const optionsContainer = document.getElementById('options-container');
        optionsContainer.innerHTML = '';
        scenario.options.forEach((option, index) => {
            const button = document.createElement('button');
            button.className = 'option-button';
            button.innerHTML = option.text;
            button.onclick = () => selectOption(index);
            optionsContainer.appendChild(button);
        });

        document.getElementById('continue-story-btn').style.visibility = 'hidden';
        document.getElementById('question-section').classList.add('visible');
    }

    function selectOption(index) {
        if (selectedOptionIndex !== null) return;
        selectedOptionIndex = index;
        const scenario = activityData.scenarios[currentScenarioIndex];
        const buttons = document.getElementById('options-container').querySelectorAll('.option-button');
        
        buttons.forEach(btn => btn.disabled = true);
        const chosenFeedback = scenario.options[index].feedback;

        if (index === scenario.correctIndex) {
            buttons[index].classList.add('correct');
            playSound(dingAudio);
             setTimeout(() => {
                showFeedbackPopup('correct', chosenFeedback);
            }, 500);
        } else {
            buttons[index].classList.add('incorrect');
            playSound(buzzAudio);
            setTimeout(() => {
                showFeedbackPopup('incorrect', chosenFeedback);
            }, 500);
        }
    }

    function handleTryAgain() {
        document.getElementById('feedback-incorrect-overlay').classList.add('hidden');
        const buttons = document.getElementById('options-container').querySelectorAll('.option-button');
        buttons.forEach(btn => {
            btn.disabled = false;
            btn.classList.remove('incorrect');
        });
        selectedOptionIndex = null;
    }

    function goToNextScenario() {
         if (window.innerWidth <= 991) {
             const bookContainer = document.getElementById('book-container');
             bookContainer.style.transition = 'opacity 0.3s';
             bookContainer.style.opacity = '0';
             setTimeout(() => {
                 loadNextContent();
                 bookContainer.style.opacity = '1';
                 bookContainer.style.transition = 'transform 0.8s cubic-bezier(0.645, 0.045, 0.355, 1)';
             }, 300);
         } else {
            const pageTurner = document.getElementById('page-turner');
            const pageTurnerFront = document.getElementById('page-turner-front');
            const bookContainer = document.getElementById('book-container');
            
            // Populate the turning page with the *current* right page content
            pageTurnerFront.innerHTML = document.querySelector('.book-page.right').innerHTML;
            
            playSound(pageTurnAudio);
            pageTurner.classList.add('turning');

            // Set the book to story view immediately so the original right page disappears
            // behind the turning animation.
            bookContainer.className = 'book-container story-view';

            pageTurner.onanimationend = () => {
                pageTurner.classList.remove('turning');
                pageTurner.onanimationend = null;
                loadNextContent();
            };
         }
    }

    function loadNextContent() {
        if (currentScenarioIndex < totalScenarios - 1) {
            currentScenarioIndex++;
            loadScenario();
        } else {
            endActivity();
        }
    }
    
    function updateProgress() {
        const progress = currentScenarioIndex;
        document.getElementById('progress-bar').style.width = `${(progress / totalScenarios) * 100}%`;
        document.getElementById('progress-text').textContent = `${progress} / ${totalScenarios}`;
    }

    function showFeedbackPopup(type, message) {
        document.getElementById(`${type}-feedback-text`).innerHTML = message;
        document.getElementById(`feedback-${type}-overlay`).classList.remove('hidden');
    }
    
    function showActivityIntro() {
        document.getElementById('start-screen').classList.add('hidden');
        document.getElementById('game-screen').classList.remove('hidden');
        document.getElementById('activity-intro-overlay').classList.remove('hidden');
        playSound(introAudio);
        sendEvent(ActivityEvent.START_ACTIVITY, {activityName: 'Aria the Eagle’s Journey'});
    }

    function showInstructions() { document.getElementById('instructions-overlay').classList.remove('hidden'); }
    
    function showHint() { 
        document.getElementById('hint-overlay').classList.remove('hidden');
    }

    function showTakeaways() { 
        document.getElementById('completion-overlay').classList.add('hidden');
        stopSound(outroAudio);
        document.getElementById('takeaways-overlay').classList.remove('hidden'); 
        sendEvent(ActivityEvent.END_ACTIVITY, {activityName: 'Aria the Eagle’s Journey'});
    }

    function closeModal(id) {
        document.getElementById(id).classList.add('hidden');
        if (id === 'activity-intro-overlay') { 
            stopSound(introAudio); 
            initGame(); 
        }
        if (id === 'feedback-correct-overlay') { 
            goToNextScenario();
        }
    }
    
    function endActivity() {
        document.getElementById('progress-bar').style.width = `100%`;
        document.getElementById('progress-text').textContent = `${totalScenarios} / ${totalScenarios}`;
        document.getElementById('game-screen').classList.add('hidden');
        document.getElementById('completion-overlay').classList.remove('hidden');
        playSound(outroAudio);
    }
    
    function restartGame() {
        stopSound(outroAudio);
        document.getElementById('completion-overlay').classList.add('hidden');
        document.getElementById('takeaways-overlay').classList.add('hidden');
        currentScenarioIndex = 0;
        document.getElementById('game-screen').classList.remove('hidden');
        loadScenario();
    }

    function goToPreviousActivity() { 
        window.location.href = "../ACTIVITY2/index.html";
        stopSound(outroAudio);
        sendEvent(ActivityEvent.END_ACTIVITY, {activityName: 'Aria the Eagle’s Journey'});
    }
    
    function populateStaticContent() {
        document.getElementById('intro-text').innerHTML = activityData.introduction;
        
        const instructionsList = document.getElementById('instructions-list');
        instructionsList.innerHTML = activityData.instructions.map(item => `<li>${item}</li>`).join('');

        const hintList = document.getElementById('hint-list');
        hintList.innerHTML = activityData.hints.map(item => `<li>${item}</li>`).join('');

        const takeawaysList = document.getElementById('takeaways-list');
        takeawaysList.innerHTML = activityData.keyTakeaways.map(item => `<li><span style="color: #28a745; font-size: 1.3em; vertical-align: middle; margin-right: 0.5em;">&#10003;</span>${item}</li>`).join('');

        document.getElementById('progress-text').textContent = `0 / ${totalScenarios}`;
    }
    
    // Initialize the game when the page loads
    document.addEventListener('DOMContentLoaded', function() {
        initAudio();
        populateStaticContent();
    });
    
</script>
<script src = "../eventSender.js"></script>
</body>
</html>