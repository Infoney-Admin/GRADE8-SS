<!DOCTYPE html>
<html lang="en-GB">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Goal Explorer</title>
<style>
    /* Font Imports and Keyframes */
    @font-face {
        font-family: 'Fredoka';
        src: url('../assets/Fredoka-VariableFont_wdth\,wght.ttf') format('truetype');
    }
    @keyframes glow-pulse-white {
        0%, 100% { box-shadow: 0 0 10px rgba(255, 255, 255, 0.7), 0 0 20px rgba(255, 255, 255, 0.5); transform: scale(1); }
        50% { box-shadow: 0 0 20px rgba(255, 255, 255, 1), 0 0 30px rgba(255, 255, 255, 0.7); transform: scale(1.1); }
    }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    @keyframes slideIn { from { transform: translateY(30px) scale(0.95); opacity: 0; } to { transform: translateY(0) scale(1); opacity: 1; } }

    /* Root Variables */
    :root {
        --font-xs: 1.1rem;
        --font-sm: 1.4rem;
        --font-md: 1.5rem;
        --font-lg: 2rem;
        --font-xl: 4rem;
        --pad-sm: 1rem;
        --pad-md: 1.6rem;
        --pad-lg: 2.4rem;
        --primary-color: #5D04B2;
        --secondary-color: #fbb03b;
        --correct-color: #4caf50;
        --incorrect-color: #e74c3c;
        --text-color-dark: #333;
        --text-color-light: #fff;
        --card-background-light: #ffffff;
        --shadow-dark: rgba(0, 0, 0, 0.3);
        --border-radius: 1rem;
        --header-font: 'Fredoka', sans-serif;
    }

    /* Global Reset & Base Styles */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { width: 100%; height: 100vh; overflow: hidden; }

    body {
        display: flex;
        justify-content: center;
        align-items: center;
        background-color: #f0f4f8;
        font-family: var(--header-font), sans-serif;
        padding: 0.5rem;
    }

    #game-wrapper {
        width: 100%;
        max-width: 1200px;
        aspect-ratio: 16 / 9;
        box-shadow: 0 15px 40px var(--shadow-dark);
        overflow: hidden;
        position: relative;
        display: flex;
        flex-direction: column;
        background: var(--card-background-light);
    }

    #game-container {
        width: 100%;
        height: 100%;
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }
    
    .screen {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
        display: flex;
        flex-direction: column;
        transition: opacity 0.5s ease-in-out;
        overflow: hidden;
    }
    .screen.hidden { opacity: 0; pointer-events: none; }
    
    #start-screen {
       background-image: url('images/gamebg.jpg');
       background-size: cover;
       background-position: center;
       justify-content: center;
       align-items: center;
       padding: 2rem;
       text-align: center;
    }
    #start-screen h1 {
      color: var(--text-color-light);
      font-size: 4rem;
      font-family: var(--header-font);
      font-weight: 500;
    }
    .start-button {
        font-family: var(--header-font);
        background: var(--secondary-color);
        color: var(--text-color-light);
        font-weight: 500;
        font-size: 1.2rem;
        border: 3px solid #fff;
        border-radius: 4.8rem;
        padding: var(--pad-sm) var(--pad-lg);
        margin-top: 1.6rem;
        cursor: pointer;
        text-shadow: 0 0.2rem 0 #b88b2a;
        transition: all 0.2s;
    }
    
    .start-button:hover { transform: scale(1.06); }

    #game-screen { background: #f8f9ff; }

    .game-top-section {
        width: 100%; flex-shrink: 0; display: flex; justify-content: space-between;
        align-items: center; background-color: var(--primary-color);
        color: var(--text-color-light); padding: clamp(0.5rem, 1.5vmin, 0.75rem) clamp(0.75rem, 2vmin, 1.25rem);
        box-shadow: 0 2px 10px rgba(0,0,0,0.2); gap: 1rem; flex-wrap: wrap;
    }
    
    #game-title {
        font-size: clamp(1.2rem, 4vmin, 1.8rem); font-weight: 600;
        text-shadow: 0 2px 4px rgba(0,0,0,0.3); flex: 1 1 300px; min-width: 0;
    }

    .progress-area { display: flex; align-items: center; gap: clamp(0.5rem, 1.5vw, 1rem); flex-shrink: 0; }
    #progress-container {
        width: clamp(100px, 20vw, 200px); background-color: rgba(255,255,255,0.3);
        border-radius: 1rem; height: clamp(15px, 2.5vmin, 20px);
        border: 2px solid #fff; position: relative; overflow: hidden;
    }
    #progress-bar {
        height: 100%; width: 0%; background: #FFFF00;
        border-radius: 0.8rem; transition: width 0.5s ease;
    }
    #progress-text {
        color: var(--text-color-light); font-weight: 700;
        font-size: clamp(0.75rem, 2vmin, 1rem); text-shadow: 1px 1px 2px rgba(0,0,0,0.6);
    }

    .instructions-icon {
        width: 40px; height: 40px; background: rgba(255, 255, 255, 0.2); border-radius: 50%;
        display: flex; align-items: center; justify-content: center; cursor: pointer;
        transition: all 0.3s ease; flex-shrink: 0; animation: glow-pulse-white 2s infinite;
    }
    .instructions-icon:hover { background: rgba(255, 255, 255, 0.3); transform: scale(1.1); }
    .instructions-icon svg { fill: white; width: 20px; height: 20px; }

    .game-content {
        flex: 1; display: flex; padding: clamp(1rem, 2vw, 2rem);
        overflow-y: auto; position: relative;
        align-items: center; justify-content: center;
    }

    /* --- Goal Explorer Styles --- */
    #goal-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: clamp(1rem, 2vw, 1.5rem);
        width: 100%;
        max-width: 1000px;
        padding: 1rem;
    }

    .category-card {
        background: #fff;
        border-radius: var(--border-radius);
        box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        overflow: hidden;
        border-left: 6px solid var(--primary-color);
    }

    .category-card.active {
        transform: scale(1.02);
        box-shadow: 0 8px 30px rgba(93, 4, 178, 0.3);
    }

    .card-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: clamp(0.75rem, 2vmin, 1.25rem);
        pointer-events: none; /* So click goes to parent card */
    }
    .card-title { font-size: clamp(1.1rem, 3vmin, 1.4rem); font-weight: 600; color: var(--text-color-dark); }
    
    .card-content {
        max-height: 0;
        opacity: 0;
        overflow: hidden;
        transition: max-height 0.5s ease-in-out, opacity 0.5s ease-in-out, padding 0.5s ease;
        padding: 0 clamp(0.75rem, 2vmin, 1.25rem);
        pointer-events: none;
        background-color: #f8f9fa;
        border-top: 1px solid #eee;
    }
    .category-card.active .card-content {
        max-height: 200px;
        opacity: 1;
        padding: clamp(0.75rem, 2vmin, 1.25rem);
        pointer-events: auto;
    }

    .goal-item {
        display: block;
        width: 100%;
        background-color: #fff;
        border: 2px solid #ddd;
        border-radius: 0.75rem;
        padding: clamp(0.5rem, 1.5vmin, 0.8rem);
        margin-bottom: 0.5rem;
        text-align: center;
        font-size: clamp(0.85rem, 2.2vmin, 1.1rem);
        cursor: pointer;
        transition: all 0.2s ease;
    }
    .goal-item:last-child { margin-bottom: 0; }
    .goal-item:hover {
        border-color: var(--secondary-color);
        background-color: #fff9f0;
        transform: translateY(-2px);
    }
    .goal-item.selected {
        background-color: var(--correct-color);
        color: white;
        border-color: var(--correct-color);
        font-weight: bold;
        box-shadow: 0 4px 10px rgba(76, 175, 80, 0.4);
    }

    /* Modal Styles */
    .modal-overlay, .overlay {
        position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        background-color: rgba(0,0,0,0.4); backdrop-filter: blur(5px);
        z-index: 3000; display: flex; justify-content: center; align-items: center;
        animation: fadeIn 0.3s ease;
    }
    .modal-overlay.hidden, .overlay.hidden { display: none; }
    .modal-content, .modal {
        background: var(--card-background-light); padding: 2.5rem;
        border-radius: var(--border-radius); text-align: center;
        width: 90%; max-width: 600px;
        animation: slideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        position: relative;
    }
    .modal-content h2, .modal h2 {
      font-size: 2rem; font-weight: 600; margin-bottom: 1.5rem;
      color: var(--primary-color);
    }
    .modal-content p, .modal p { font-size: 1.2rem; line-height: 1.6; color: var(--text-color-dark); }
     .modal ul {
        list-style-type: none; text-align: left; margin-top: 1rem; padding: 0;
    }
    .modal li { margin-bottom: 0.8rem; padding-left: 1.5rem; position: relative; font-size: 1.1em; line-height: 1.5; }

    .modal-btn {
        width: 100%; padding: 1rem; font-size: 1.2rem; font-weight: 700;
        border: none; border-radius: 0.75rem; cursor: pointer; color: #fff;
        background-color: var(--primary-color); transition: transform 0.2s, box-shadow 0.2s;
        margin-top: 1.5rem;
    }
    .modal-btn:hover { transform: scale(1.02); }

    #activity-intro-overlay .modal-content, #instructions-overlay .modal-content { border-top: 8px solid var(--primary-color); }
    #activity-intro-overlay .modal-content p {
        text-align: center; background: #f8f9fa; padding: 1.5rem;
        border-radius: 0.75rem; border-left: 4px solid var(--primary-color);
        line-height: 1.5; font-size: 1.2rem; color: var(--text-color-dark); font-style: italic;
    }
    #instructions-overlay .modal-content ul { padding: 0; }
    #instructions-overlay .modal-content li::before { 
        content: 'â€¢'; position: absolute; left: 0; font-size: 1.5em; 
        color: var(--primary-color); line-height: 1;
    }
    #instructions-overlay .modal-content .hint-list { margin-top: 1.5rem; padding-top: 1.5rem; border-top: 1px solid #eee; }
    
    /* Completion & Takeaways Overlay Styles */
    #completion-overlay { 
        background-image: url('images/gamebg.jpg'); background-size: cover; background-position: center;
        flex-direction: column; justify-content: center; align-items: center;
    }
    .completion-title-banner { 
        color: var(--text-color-light);
        font-size: clamp(2rem, 7vmin, 4rem);
        text-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.2);
        text-align: center; font-family: var(--header-font);
        font-weight: 500;
        margin-bottom: 0.5rem;
    }
    #completion-overlay .modal {
        background: transparent; box-shadow: none; padding: 0; overflow: visible;
        width: auto; max-width: none;margin-bottom: 4rem;
    }
    #completion-image { 
        width: clamp(400px, 70%, 700px); max-width: 85%; height: auto;
        border: 3px solid var(--secondary-color); border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3); margin-top: 0.5rem;
    }
    .completion-buttons {
        position: absolute; bottom: 2rem; width: 100%; display: flex;
        justify-content: center; gap: 1.5rem; padding: 0 2rem;
    }
    .completion-btn {
      font-family: var(--header-font); background: var(--secondary-color); color: #fff;
        font-weight: 500; font-size: 1.3rem; border: 0.1875rem solid #fff; border-radius: 3rem; 
        padding: clamp(0.5rem, 1.5vmin, 0.75rem) clamp(1.25rem, 3vmin, 2rem);
        cursor: pointer; transition: all 0.2s; box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.2);
        text-shadow: 0 0.125rem 0 #b88b2a; text-decoration: none; min-width: 8.75rem;
    }
    .completion-btn:hover { transform: scale(1.05); }
    
    .visually-hidden {
        position: absolute; width: 1px; height: 1px; margin: -1px; padding: 0;
        overflow: hidden; clip: rect(0, 0, 0, 0); border: 0;
    }
    
    @media (max-width: 991px) {
       #game-wrapper {
            width: 100vw !important; height: 100vh !important;
            min-width: 100vw !important; min-height: 100vh !important;
            border-radius: 0 !important; max-width: none !important;
            aspect-ratio: unset !important; box-shadow: none;
        }
        #goal-grid { grid-template-columns: repeat(2, 1fr); }
        #completion-image { max-width: 60%; }
        .completion-buttons {align-items: center; bottom: 1rem; gap: 1rem; flex-wrap: wrap; }
        .completion-btn{
            font-size: 1rem; padding: clamp(0.4rem, 1.2vmin, 0.6rem) clamp(1rem, 2.5vmin, 1.5rem);
        }
        #instructions-overlay .modal-content { height: 90vh; overflow-y: auto; }
    }
    
    @media (max-width: 768px) {
        body { padding: 0; }
        #goal-grid { grid-template-columns: 1fr; gap: 0.8rem; padding: 0.8rem; }
        .card-title { font-size: 1.2rem; }
        .goal-item { font-size: 1rem; }
    }
</style>
</head>
<body>
<div id="game-wrapper">
   <div id="game-container">
        <div id="start-screen" class="screen">
            <h1>Goal Explorer</h1>
            <button class="start-button">Start Activity</button>
        </div>

        <div id="game-screen" class="screen hidden">
            <div class="game-top-section">
               <h1 id="game-title">Goal Explorer</h1>
               <div class="progress-area">
                   <div id="progress-container"><div id="progress-bar"></div></div>
                   <div id="progress-text">0 / 6</div>
               </div>
               <div class="instructions-icon" id="instructions-icon" aria-label="Show instructions">
                   <svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>
               </div>
            </div>
            <div class="game-content">
                <main id="goal-grid"></main>
            </div>
        </div>

        <div id="activity-intro-overlay" class="modal-overlay hidden">
            <div class="modal-content">
                <h2>Activity Introduction</h2>
                <p>"Goals come in many forms. In this activity, you will explore different types of goals and discover examples that inspire you to grow. Each branch will show you a goal you can relate to in your own life."</p>
                <button class="modal-btn" id="intro-continue-btn">Continue</button>
            </div>
        </div>

        <div id="instructions-overlay" class="modal-overlay hidden">
           <div class="modal-content">
               <h2>Learner Instructions</h2>
               <ul>
                   <li>Click on each category to see example goals.</li>
                   <li>Choose one that connects with your interests.</li>
               </ul>
               <ul class="hint-list">
                   <li>Is your goal about learning, helping others, or improving health?</li>
                   <li>Think about what you want to achieve this term.</li>
               </ul>
               <button class="modal-btn" id="close-instructions-btn">Got it!</button>
           </div>
        </div>
       
        <div id="completion-overlay" class="overlay hidden">
            <div class="completion-title-banner">Great Exploring!</div>
            <div class="modal">
                <img id="completion-image" src="images/complete.jpg" alt="Activity Complete" onerror="this.style.display='none'">
            </div>
            <div class="completion-buttons">
                <button class="completion-btn btn-previous">Previous Activity</button>
                <button class="completion-btn btn-restart">Restart Activity</button>
                <button class="completion-btn btn-next">Next Activity</button>
            </div>
        </div>
        
        <div id="aria-live-announcer" class="visually-hidden" aria-live="polite"></div>
        
    <audio id="ding-sound" src="audio/ding.mp3" preload="auto"></audio>
    <audio id="buzz-sound" src="audio/buzz.mp3" preload="auto"></audio>
    <audio id="intro-sound" src="audio/intro.mp3" preload="auto"></audio>
    <audio id="outro-sound" src="audio/outro.mp3" preload="auto"></audio>
   </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Event Handling ---
    const sendEvent = (eventName, eventData) => {
        if (window.parent) {
            const event = new CustomEvent('lessonEvent', { detail: { name: eventName, data: eventData } });
            window.parent.document.dispatchEvent(event);
        }
    };
    const ActivityEvent = { END_ACTIVITY: 'END_ACTIVITY' };

    // --- DOM Elements ---
    const startScreen = document.getElementById('start-screen'), gameScreen = document.getElementById('game-screen');
    const startBtn = document.querySelector('.start-button');
    const goalGrid = document.getElementById('goal-grid');
    const announcer = document.getElementById('aria-live-announcer');
    const progressBar = document.getElementById('progress-bar'), progressText = document.getElementById('progress-text');
    const activityIntroOverlay = document.getElementById('activity-intro-overlay'), introContinueBtn = document.getElementById('intro-continue-btn');
    const instructionsIcon = document.getElementById('instructions-icon'), instructionsOverlay = document.getElementById('instructions-overlay'), closeInstructionsBtn = document.getElementById('close-instructions-btn');
    const completionOverlay = document.getElementById('completion-overlay');
    const dingSound = document.getElementById('ding-sound'), introSound = document.getElementById('intro-sound'), outroSound = document.getElementById('outro-sound');

    // Game State
    let isPaused = true;
    let activityCompleted = false;
    let exploredCards = new Set();

    // --- Data ---
    const goalData = [
        { category: 'Academic', goals: ['Improve my grades in Social Studies', 'Read one book every two weeks'] },
        { category: 'Social', goals: ['Speak to one new person weekly', 'Join a club at school'] },
        { category: 'Health', goals: ['Play football twice weekly', 'Drink more water daily'] },
        { category: 'Career', goals: ['Learn about careers in law', 'Shadow a local professional'] },
        { category: 'Creativity', goals: ['Learn drawing techniques', 'Write a short poem monthly'] },
        { category: 'Community', goals: ['Volunteer at a local event', 'Help organise a school clean-up'] }
    ];

    // --- Sound ---
    function playSound(sound) { if(sound) { sound.currentTime = 0; sound.play().catch(e => console.log("Sound play failed:", e)); } }
    function stopSound(sound) { if(sound) { sound.pause(); } }

    // --- UI Update ---
    function updateProgress() {
        const progress = exploredCards.size;
        const total = goalData.length;
        progressBar.style.width = `${(progress / total) * 100}%`;
        progressText.textContent = `${progress} / ${total}`;

        if (progress === total && !activityCompleted) {
            activityCompleted = true;
            isPaused = true;
            setTimeout(() => {
                completeActivity();
            }, 1200);
        }
    }

    // --- Activity Setup ---
    function setupActivity() {
        isPaused = false;
        activityCompleted = false;
        exploredCards.clear();
        goalGrid.innerHTML = '';
        updateProgress();

        goalData.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'category-card';
            card.dataset.index = index;
            
            let goalsHtml = item.goals.map(goal => `<button class="goal-item">${goal}</button>`).join('');

            card.innerHTML = `
                <div class="card-header">
                    <h3 class="card-title">${item.category}</h3>
                </div>
                <div class="card-content">
                    ${goalsHtml}
                </div>
            `;
            goalGrid.appendChild(card);
        });

        addEventListeners();
    }

    // --- Event Listeners ---
    function addEventListeners() {
        document.querySelectorAll('.category-card').forEach(card => {
            card.addEventListener('click', handleCategoryClick);
        });

        document.querySelectorAll('.goal-item').forEach(button => {
            button.addEventListener('click', handleGoalSelection);
        });
    }

    function handleCategoryClick(event) {
        if (isPaused || activityCompleted) return;
        const clickedCard = event.currentTarget;
        const cardIndex = clickedCard.dataset.index;

        // If it's already active, deactivate it
        if (clickedCard.classList.contains('active')) {
            clickedCard.classList.remove('active');
            announce(`${clickedCard.querySelector('.card-title').textContent} category collapsed.`);
        } else {
            // Deactivate any other active card
            const currentActive = document.querySelector('.category-card.active');
            if (currentActive) {
                currentActive.classList.remove('active');
            }
            // Activate the new one
            clickedCard.classList.add('active');
            announce(`${clickedCard.querySelector('.card-title').textContent} category expanded.`);

            // Update progress if this is the first time clicking it
            if (!exploredCards.has(cardIndex)) {
                exploredCards.add(cardIndex);
                playSound(dingSound);
                updateProgress();
            }
        }
    }

    function handleGoalSelection(event) {
        event.stopPropagation(); // Prevent card from toggling
        if (isPaused || activityCompleted) return;
        
        const selectedButton = event.currentTarget;
        
        document.querySelectorAll('.goal-item.selected').forEach(btn => {
            btn.classList.remove('selected');
        });

        selectedButton.classList.add('selected');
        announce(`Goal selected: ${selectedButton.textContent}.`);
    }

    function completeActivity() {
        sendEvent(ActivityEvent.END_ACTIVITY, { activityName: 'Goal Explorer' });
        completionOverlay.classList.remove('hidden');
        playSound(outroSound);
    }

    function announce(text) { 
        announcer.textContent = '';
        setTimeout(() => { announcer.textContent = text; }, 100);
    }
    
    // --- Main Initialization ---
    function init() {
        startBtn.addEventListener('click', () => {
            startScreen.classList.add('hidden');
            gameScreen.classList.remove('hidden');
            activityIntroOverlay.classList.remove('hidden');
            isPaused = true;
            playSound(introSound);
            setupActivity();
        });

        introContinueBtn.addEventListener('click', () => {
            activityIntroOverlay.classList.add('hidden');
            isPaused = false;
            stopSound(introSound);
        });

        instructionsIcon.addEventListener('click', () => {
            instructionsOverlay.classList.remove('hidden');
            isPaused = true;
        });

        closeInstructionsBtn.addEventListener('click', () => {
            instructionsOverlay.classList.add('hidden');
            if (!activityCompleted) {
                isPaused = false;
            }
        });

        completionOverlay.querySelector('.btn-restart').addEventListener('click', () => {
            stopSound(outroSound);
            completionOverlay.classList.add('hidden');
            setupActivity();
        });
        
        // Navigation buttons
        completionOverlay.querySelector('.btn-previous').addEventListener('click', () => {
            stopSound(outroSound);
            window.location.href = '../ACTIVITY_PREVIOUS/index.html'; // Adjust link as needed
        });
        completionOverlay.querySelector('.btn-next').addEventListener('click', () => {
            stopSound(outroSound);
            window.location.href = '../ACTIVITY_NEXT/index.html'; // Adjust link as needed
        });
    }

    init();
});
</script>
<script src="../eventSender.js"></script>
</body>
</html>